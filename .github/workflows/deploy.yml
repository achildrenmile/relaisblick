name: Deploy

on:
  workflow_run:
    workflows: ["Build and Push Docker Image"]
    types:
      - completed
    branches:
      - main
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' || github.event_name == 'workflow_dispatch' }}

    steps:
      - name: Deploy notification
        run: |
          echo "Deployment triggered for relaisblick"
          echo "Commit: ${{ github.sha }}"
          echo "Branch: ${{ github.ref_name }}"

      # Add your deployment steps here, for example:
      #
      # Option 1: SSH to server and pull new image
      # - name: Deploy to server
      #   uses: appleboy/ssh-action@v1.0.3
      #   with:
      #     host: ${{ secrets.DEPLOY_HOST }}
      #     username: ${{ secrets.DEPLOY_USER }}
      #     key: ${{ secrets.DEPLOY_KEY }}
      #     script: |
      #       cd /opt/relaisblick
      #       docker compose pull
      #       docker compose up -d
      #
      # Option 2: Webhook to trigger deployment
      # - name: Trigger deployment webhook
      #   run: |
      #     curl -X POST "${{ secrets.DEPLOY_WEBHOOK_URL }}" \
      #       -H "Content-Type: application/json" \
      #       -d '{"ref": "${{ github.sha }}"}'
      #
      # Option 3: Deploy to cloud provider (e.g., Railway, Fly.io)
      # - name: Deploy to Fly.io
      #   uses: superfly/flyctl-actions/setup-flyctl@master
      # - run: flyctl deploy --remote-only
      #   env:
      #     FLY_API_TOKEN: ${{ secrets.FLY_API_TOKEN }}

      - name: Deployment complete
        run: echo "Configure deployment steps in .github/workflows/deploy.yml"
